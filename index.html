<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì´ë©”ì¼ í—¤ë” IP ì¶”ì¶œ</title>
<style>
  * { font-family: 'Pretendard', 'NOTO SANS KR'; }
  body {
    padding: 20px;
    max-width: 800px;
    margin: auto;
  }
  textarea {
    font-size: 16px;
    width: 100%;
    height: 200px;
  }
  .ip-result {
    margin-top: 20px;
    padding: 10px;
    background-color: #f0f0f0;
    border-radius: 5px;
  }
  .ip-entry {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .provider {
    margin: 10px 0;
    font-weight: bold;
    color: #555;
  }
  button {
    background-color: #4A90E2;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover { background-color: #357ABD; }
  .fixed-width { width: 200px; }
  .btn-group { margin-top: 15px; }
  .btn-group button { margin-right: 10px; }

  /* "ìì„¸í•œ IP ìœ„ì¹˜ì¡°íšŒ" ë²„íŠ¼ ë³„ë„ ìŠ¤íƒ€ì¼ */
  .btn-blue-outline {
    border: 1px solid #4A90E2;
    background-color: white;
    color: #4A90E2;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
  }
  .btn-blue-outline:hover {
    background-color: #f0f0f0;
    color: #4A90E2;
  }

  .header-guide a {
    color: inherit;
    text-decoration: none;
    font-size: 15px;
  }
  .header-guide a:hover { text-decoration: underline; }
  .ip-copy-btn {
    background-color: #6c757d;
    color: white;
    border: none;
    padding: 4px 10px;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
  }
  .ip-copy-btn:hover { background-color: #5a6268; }
</style>
</head>
<body>

<h1 style="font-size: 28px;">ğŸ“§ ë°œì‹ ì IP ì°¾ê¸°</h1>

<div class="header-guide">
  <a style="color: #4A90E2;" href="https://drive.google.com/file/d/1Pfe-CpoGxF0YmAGp8h44bWryROK8248I/view?usp=drive_link" target="_blank">
    â–¶ [ì•„ì›ƒë£©] ë©”ì¼í—¤ë” ë³´ëŠ”ë²•&nbsp;
  </a>
  <a style="color: #4A90E2;" href="https://drive.google.com/file/d/1GKvQqY5dmx1_i1fKWh9k7RrirDnEWamV/view?usp=drive_link" target="_blank">
    â–¶ [ì›¹ë©”ì¼] ë©”ì¼í—¤ë” ë³´ëŠ”ë²•
  </a>

  <div style="font-size: 15px; line-height: 2.0; ">
    <ol>
      <li>ë³µì‚¬í•œ ì´ë©”ì¼ í—¤ë”ë¥¼ ì…ë ¥ í›„, <strong>â€œIP ì¶”ì¶œâ€</strong> ë²„íŠ¼ í´ë¦­</li>
      <li><strong>â€œì„¸ìë¦¬ ë³µì‚¬â€</strong> ë²„íŠ¼ í´ë¦­ (ìì„¸í•œ IP ìœ„ì¹˜ì¡°íšŒ ì‹œ ì „ì²´ ë³µì‚¬)</li>
      <li><strong>â€œì ‘ì†IP ëŒ€ì¡° ì‹œíŠ¸â€</strong>ì—ì„œ Ctrl+Fë¡œ ê²€ìƒ‰ í›„ í™•ì¸</li>
      <li>ì°¨ë‹¨í•  IPë¥¼ ì‹œíŠ¸ ìš°ì¸¡ì— ì…ë ¥</li>
  
    </ol>
  </div>
</div>

<textarea id="headerInput" placeholder="ì´ë©”ì¼ í—¤ë”ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>

<br><br>
<button id="extractBtn" class="fixed-width" onclick="extractIPs()">IP ì¶”ì¶œ</button>

<div class="provider" id="providerBox"></div>
<div class="ip-result" id="resultBox"></div>

<div class="btn-group">
  <button class="fixed-width" onclick="window.open('https://docs.google.com/spreadsheets/d/1bCTTHagd_ewqsP9ACqu3IFtdwRPVsWZ-mf8pg-7jYyY/edit?usp=sharing', '_blank')">
    ì ‘ì† IP ë‚´ì—­ ì‹œíŠ¸
  </button>
  <button class="fixed-width btn-blue-outline" onclick="window.open('https://mylocation.co.kr/', '_blank')">
    ìì„¸í•œ IP ìœ„ì¹˜ì¡°íšŒ
  </button>
</div>

<script>
async function getIPLocation(ip) {
  try {
    const res = await fetch(`https://ipapi.co/${ip}/json/`);
    if (!res.ok) throw new Error();
    const data = await res.json();
    return `${data.city || '-'}, ${data.region || '-'}, ${data.country_name || '-'}`;
  } catch {
    return 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ';
  }
}

async function extractIPs() {
  const input = document.getElementById('headerInput').value;
  const resultBox = document.getElementById('resultBox');
  resultBox.innerHTML = 'IP ì¶”ì¶œ ì¤‘...';

  const ipRegex = /\b(?:\d{1,3}\.){3}\d{1,3}\b/g;
  const receivedLines = input.split(/\r?\n/).filter(line => line.toLowerCase().startsWith("received"));
  const ipSet = new Set();

  for (const line of receivedLines) {
    const matches = line.match(ipRegex);
    matches?.forEach(ip => {
      const [a,b] = ip.split('.').map(Number);
      const isPrivate =
        a === 10 || a === 127 ||
        (a === 192 && b === 168) ||
        (a === 172 && b >= 16 && b <= 31);
      if (!isPrivate) ipSet.add(ip);
    });
  }

  if (!ipSet.size) {
    resultBox.innerHTML = 'ìœ íš¨í•œ ì™¸ë¶€ IP ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    return;
  }

  resultBox.innerHTML = '<strong>IP ì£¼ì†Œ ë° ìœ„ì¹˜ ì •ë³´:</strong><br><br>';
  for (const ip of ipSet) {
    const location = await getIPLocation(ip);
    const div = document.createElement('div');
    div.className = 'ip-entry';
    div.innerHTML = `
      <strong>${ip}</strong> â†’ ${location}
      <button class="ip-copy-btn" onclick="copyShortIP('${ip}')">ì„¸ìë¦¬ ë³µì‚¬</button>
      <button class="ip-copy-btn" onclick="copyIP('${ip}')">ì „ì²´ ë³µì‚¬</button>

    `;
    resultBox.appendChild(div);
  }
}

function copyIP(ip) {
  navigator.clipboard.writeText(ip).catch(err => alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err));
}

function copyShortIP(ip) {
  navigator.clipboard.writeText(ip.split('.').slice(0, 3).join('.') + '.')
    .catch(err => alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err));
}
</script>

</body>
</html>

